{% extends 'base.html' %}
{% block title %}{{ task.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-lg border-0">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="fw-bold mb-0">{{ task.title }}</h2>

                <form method="post" action="{% url 'task-complete' task.id %}">
                    {% csrf_token %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               id="task-{{ task.id }}"
                               name="is_completed"
                               onchange="this.form.submit()"
                               {% if task.is_completed %}checked{% endif %}>
                        <label class="form-check-label fw-semibold" for="task-{{ task.id }}">
                            ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                        </label>
                    </div>
                </form>
            </div>

            <hr>

            <p class="lead text-muted">{{ task.description }}</p>

            <div class="mb-3">
                <span class="badge
                    {% if task.status == 'done' %}
                        bg-success
                    {% elif task.status == 'in_progress' %}
                        bg-warning text-dark
                    {% else %}
                        bg-secondary
                    {% endif %}
                ">
                    {{ task.get_status_display }}
                </span>

                <span class="badge
                    {% if task.priority == 'high' %}
                        bg-danger
                    {% elif task.priority == 'medium' %}
                        bg-primary
                    {% else %}
                        bg-info text-dark
                    {% endif %}
                ">
                    üî• {{ task.get_priority_display }}
                </span>
            </div>

            <p class="mb-1"><b>üìÖ –î–µ–¥–ª–∞–π–Ω:</b> {{ task.due_date|date:"d M Y" }}</p>
            <p class="mb-1"><b>üïí –°—Ç–≤–æ—Ä–µ–Ω–æ:</b> {{ task.created_at|date:"d M Y H:i" }}</p>
            <p class="mb-3"><b>üë§ –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:</b> {{ task.user.username }}</p>

            <div class="d-flex gap-2 mb-3">
                <a href="{% url 'task-update' task.pk %}" class="btn btn-outline-secondary">‚úè –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                <a href="{% url 'task-delete' task.pk %}" class="btn btn-outline-danger">üóë –í–∏–¥–∞–ª–∏—Ç–∏</a>
                <a href="{% url 'task-list' %}" class="btn btn-outline-dark">‚¨Ö –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</a>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <h4 class="fw-bold mb-3">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h4>

        {% for comment in comments %}
            <div class="card shadow-sm mb-3 border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="fw-bold mb-1">
                            üë§ {{ comment.author.username }}
                            <small class="text-muted">‚Äî {{ comment.created_at|date:"d M Y H:i" }}</small>
                        </h6>
                    </div>

                    <p class="mb-2">{{ comment.content }}</p>

                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <a href="{% url 'comment-like' comment.id %}" class="btn btn-sm btn-outline-primary">
                                ‚ù§Ô∏è {{ comment.likes.count }}
                            </a>
                        </div>

                        {% if comment.author == user %}
                            <div>
                                <a href="{% url 'comment-edit' comment.id %}" class="btn btn-sm btn-outline-warning">‚úè –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                                <a href="{% url 'comment-delete' comment.id %}" class="btn btn-sm btn-outline-danger">üóë –í–∏–¥–∞–ª–∏—Ç–∏</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% empty %}
            <p class="text-muted">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä—à–∏–º! üöÄ</p>
        {% endfor %}
    </div>

    <div class="card shadow-sm border-0 mt-4 mb-5">
        <div class="card-body">
            <h5 class="fw-bold mb-3">üìù –î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</h5>
            <form method="post">
                {% csrf_token %}
                {{ form.content }}
                <button type="submit" class="btn btn-success">üíæ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}